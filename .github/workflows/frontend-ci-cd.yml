name: Frontend CI/CD

on:
  push:
    branches: [ main, developer ]
  pull_request:
    branches: [ developer ]

jobs:
  build_and_test:
    # Este job roda para a branch '''developer'''
    if: github.ref == '''refs/heads/developer''' || github.base_ref == '''refs/heads/developer'''
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '''18'''

      - name: Install dependencies
        working-directory: ./frontend
        run: npm ci

      - name: Build
        working-directory: ./frontend
        run: ng build --configuration production

      - name: Test
        working-directory: ./frontend
        run: ng test --watch=false --browsers=ChromeHeadless

  deploy_to_vercel:
    # Este job roda APENAS em push para a '''main'''
    if: github.ref == '''refs/heads/main''' && github.event_name == '''push'''
    runs-on: ubuntu-latest
    needs: build_and_test # Opcional: pode rodar ap√≥s build_and_test da main
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Deploy to Vercel
        uses: amondnet/vercel-action@v25
        with:
          vercel-token: ${{ secrets.VERCEL_TOKEN }}
          vercel-org-id: ${{ secrets.VERCEL_ORG_ID }}
          vercel-project-id: ${{ secrets.VERCEL_PROJECT_ID }}
          vercel-project-name: "gerenciador-clientes-frontend" # Nome do projeto na Vercel
          working-directory: ./frontend
          scope: ${{ secrets.VERCEL_SCOPE }} # Seu user ou team name na Vercel